version: '3'

vars:
  DOCKER_IMAGE: zakuro/zakuro-cache
  NTERMS: 35

tasks:
  build:
    desc: Build the Docker image
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    cmds:
      - docker build . -t {{.DOCKER_IMAGE}}

  run:
    desc: Run the demo inside Docker with caching enabled
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    deps:
      - build
    cmds:
      - docker run --rm -it {{.DOCKER_IMAGE}} time python demo.py --nterms {{.NTERMS}}

  run-nocache:
    desc: Run the demo inside Docker with caching disabled
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    deps:
      - build
    cmds:
      - docker run --rm -it {{.DOCKER_IMAGE}} time python demo.py --nocache --nterms {{.NTERMS}}

  benchmark:
    desc: Run full benchmark comparing cached vs uncached execution (mirrors docker.sh)
    aliases:
      - bench
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    cmds:
      - docker build . -t {{.DOCKER_IMAGE}}
      - docker run --rm -it {{.DOCKER_IMAGE}} time python demo.py
      - docker run --rm -it {{.DOCKER_IMAGE}} time python demo.py --nocache

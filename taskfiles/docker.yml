version: '3'

vars:
  NTERMS: 35

tasks:
  build:
    desc: Build the Docker image
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    cmds:
      - docker compose build

  run:
    desc: Run the demo inside Docker with caching enabled
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    deps:
      - build
    cmds:
      - docker compose run --rm demo time python demo.py --nterms {{.NTERMS}}

  run-nocache:
    desc: Run the demo inside Docker with caching disabled
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    deps:
      - build
    cmds:
      - docker compose run --rm demo-nocache time python demo.py --nocache --nterms {{.NTERMS}}

  benchmark:
    desc: Run full benchmark comparing cached vs uncached execution
    aliases:
      - bench
    preconditions:
      - sh: command -v docker
        msg: "docker is required but not installed"
    cmds:
      - docker compose build
      - docker compose run --rm demo
      - docker compose run --rm demo-nocache
